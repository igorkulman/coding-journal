{{/*
    =======
    Based on...
    - https://github.com/hugomd/blog/blob/6ad96b24117255c2a9912c566ffd081bd9bbd6f1/layouts/shortcodes/statictweet.html
    - https://hugo.md/post/update-rendering-static-tweets/
    - https://github.com/KyleMit/eleventy-plugin-embed-tweet
    =======
  */}}
  
  {{ $urlPre := "https://cdn.syndication.twimg.com/tweet?id="}}
  {{ $id := .Get 0 }}
  {{ $json := getJSON $urlPre $id }}
  {{ $text := .Page.RenderString $json.text }}
  
  {{ if isset $json "entities" }}
    {{ if isset $json.entities "user_mentions"  }}
      {{ range $user := $json.entities.user_mentions}}
        {{ $text = replace $text (printf "@%s" $user.screen_name) (printf "<a href='https://twitter.com/%s' target='_blank' rel='noopener'>@%s</a>" $user.screen_name $user.screen_name) }}
      {{ end }}
    {{ end }}
    {{ if isset $json.entities "hashtags"}}
      {{ range $hashtags := $json.entities.hashtags }}
        {{ $text = replace $text (printf "#%s" $hashtags.text) (printf "<a href='https://twitter.com/hashtag/%s?src=hash&ref_src=twsrc' target='_blank' rel='noopener'>#%s</a>" $hashtags.text $hashtags.text) }}
      {{ end }}
    {{ end }}
    {{ if isset $json.entities "media"  }}
      {{ range $media := $json.entities.media }}
        {{ $text = replace $text $media.url "" }}
      {{ end }}
    {{ end }}
    {{ if isset $json.entities "urls"  }}
      {{ range $url := $json.entities.urls}}
        {{ $text = replace $text $url.url (printf "<a href='%s' target='_blank' rel='noopener'>%s</a>" $url.url $url.display_url) }}
      {{ end }}
    {{ end }}
  {{ end }}
  
  <div><div class="static-tweet-embed">
    <a class="author" href="https://twitter.com/{{ $json.user.screen_name}}"><img src="{{ $json.user.profile_image_url_https }}" loading="lazy" alt="{{ $json.user.screen_name}} avatar" /><b>{{ $json.user.screen_name}}</b>@${{ $json.user.screen_name}}</a>
    <blockquote>
      {{ .Page.RenderString $text }}      
    </blockquote>
    {{ if isset $json "photos" }}
      <div class="media">
      {{ range $item := $json.photos }}
        <img src="{{ $item.url }}" alt="Image from tweet {{ $id }}" loading="lazy" />
      {{ end }}
      </div>
    {{ end }}
    <div class="time">
      <a href="https://twitter.com/{{ $json.user.screen_name }}/status/{{ $json.id_str }}">{{ dateFormat "15:04 â€¢ January 2, 2006" $json.created_at }}</a>
    </div>
  </div></div>